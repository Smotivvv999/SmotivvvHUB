local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "SuperStarHub || Premium  -  v1.1.0",
   Icon = 0, -- Icon in Topbar. Can use Lucide Icons (string) or Roblox Image (number). 0 to use no icon (default).
   LoadingTitle = "Loading Script...",
   LoadingSubtitle = "by Sirius",
   ShowText = "SuperStarHub", -- for mobile users to unhide rayfield, change if you'd like
   Theme = "Default", -- Check https://docs.sirius.menu/rayfield/configuration/themes
})

pcall(function()
    local VirtualUser = game:GetService("VirtualUser")
    game:GetService("Players").LocalPlayer.Idled:Connect(function()
        VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        task.wait(0.1)
        VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        print("Anti-AFK aktif: aktivitas virtual dikirim.")
    end)
end)

local Tab = Window:CreateTab("Autofarm", "plane-takeoff")

local Section = Tab:CreateSection("Autofarm Fast")

local Player = game.Players.LocalPlayer
local CarName = Player.Name .. "sCar"
local TweenService = game:GetService("TweenService")
local Vim = game:GetService("VirtualInputManager")

-- Fungsi helper Tween dengan wait sampai selesai
local function TweenCFrame(part, targetCFrame, duration, easingStyle, easingDirection)
    duration = duration or 1
    easingStyle = easingStyle or Enum.EasingStyle.Quad
    easingDirection = easingDirection or Enum.EasingDirection.Out

    local tweenInfo = TweenInfo.new(duration, easingStyle, easingDirection)
    local tween = TweenService:Create(part, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
    tween.Completed:Wait()
end

-- Fungsi tween teleport ke area kerja, diperbaiki menunggu tween selesai
function TweenToJob()
    game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")

    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end

    TweenCFrame(Root, Root.CFrame + Vector3.new(0, 100, 0), 0.5, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(-21799.8, 1142.65, -26797.7), 1, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(-21799.8, 1042.65, -26797.7), 1, Enum.EasingStyle.Exponential)

    Root.Anchored = true
    task.wait(0.3)
    Root.Anchored = false
end

-- Fungsi mengambil job "Truck" dengan sedikit perbaikan
function TakingJob()
    repeat
        local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
        local Waypoint = workspace.Etc.Waypoint:FindFirstChild("Waypoint")
        local Label = Waypoint and Waypoint:FindFirstChild("BillboardGui") and Waypoint.BillboardGui:FindFirstChild("TextLabel")

        if Root then Root.Anchored = true end

        if Label and Label.Text ~= "Rojod Semarang" then
            game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")
            local Prompt = workspace.Etc.Job.Truck.Starter:FindFirstChildWhichIsA("ProximityPrompt", true)
            if Prompt then
                Prompt.MaxActivationDistance = 100000
                fireproximityprompt(Prompt)
            end
        end

        if Root then Root.Anchored = false end
        task.wait(1) -- lebih panjang supaya tidak membebani
    until Label and Label.Text == "Rojod Semarang"

    Player.Character.HumanoidRootPart.Anchored = false
end

-- Fungsi spawn mobil + langsung duduk + destroy trailer (tidak saya ubah)
function SpawningTruck()
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end

    Root.CFrame = CFrame.new(-21782.941, 1042.03, -26786.959)

    task.wait(2)
    local Vim = game:GetService("VirtualInputManager")
    Vim:SendKeyEvent(true, "F", false, game)
    task.wait(0.3)
    Vim:SendKeyEvent(false, "F", false, game)
    task.wait(5)

    local Car = workspace.Vehicles:FindFirstChild(CarName)
    local Humanoid = Player.Character and Player.Character:FindFirstChild("Humanoid")
    local Seat = Car and Car:FindFirstChild("DriveSeat")

    if Humanoid and Seat then
        pcall(function() Seat:Sit(Humanoid) end)
        task.wait(0.5)
        Vim:SendKeyEvent(true, "Space", false, game)
        task.wait(0.1)
        Vim:SendKeyEvent(false, "Space", false, game)
    end

    local Trailer = Car and Car:FindFirstChild("Trailer1")
    if Trailer then
        Trailer:Destroy()
        print("Trailer destroyed to prevent interference.")
    end
end

-- Fungsi MovingCharacterToDestination sudah dioptimasi agar loop pivotTo lebih lambat dan terhenti tepat waktu
function MovingCharacterToDestination(Destination)
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    local Car = workspace.Vehicles:FindFirstChild(CarName)
    if not (Root and Car) then return end

    if not Car.PrimaryPart then
        for _, Part in ipairs(Car:GetDescendants()) do
            if Part:IsA("BasePart") then
                Car.PrimaryPart = Part
                break
            end
        end
    end

    local Follow = true
    local pivotThread = task.spawn(function()
        while Follow do
            if Car.PrimaryPart then
                Car:PivotTo(Root.CFrame + Vector3.new(5, 0, 0))
            end
            task.wait(0.3) -- lebih longgar supaya device gak berat
        end
    end)

    TweenCFrame(Root, Root.CFrame + Vector3.new(0, 100, 0), 0.4, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(Destination.Position + Vector3.new(0, 100, 0)), 1.6, Enum.EasingStyle.Sine)
    TweenCFrame(Root, Destination, 1.8, Enum.EasingStyle.Exponential)

    Follow = false -- stop pivot thread

    Root.Anchored = true
    if Car.PrimaryPart then Car.PrimaryPart.Anchored = true end
    task.wait(0.8)
    if Car.PrimaryPart then Car.PrimaryPart.Anchored = false end
    Root.Anchored = false
end

function CountdownTeleport(seconds)
    for i = seconds, 1, -1 do
        print("Teleporting in " .. i .. " seconds...")
        task.wait(1)
    end
end

function SitInVehicle()
    local Car = workspace.Vehicles:FindFirstChild(CarName)
    local Hum = Player.Character and Player.Character:FindFirstChild("Humanoid")
    local Seat = Car and Car:FindFirstChild("DriveSeat")
    if Hum and Seat then pcall(function() Seat:Sit(Hum) end) end
end

-- CarTween sudah dioptimasi dengan wait tween selesai dan menghindari anchored toggle terlalu sering
function CarTween(TargetCFrame)
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end
    Root.Anchored = false

    task.wait(0.2)

    local Car = workspace.Vehicles:FindFirstChild(CarName)
    if not Car then warn("Vehicle not found.") return end
    if not Car.PrimaryPart then
        local Seat = Car:FindFirstChild("DriveSeat")
        if Seat then Car.PrimaryPart = Seat else return end
    end

    local Temp = Instance.new("CFrameValue", workspace)
    Temp.Value = Car:GetPivot()

    local Tween = TweenService:Create(Temp, TweenInfo.new(3, Enum.EasingStyle.Linear), {
        Value = TargetCFrame
    })

    Temp:GetPropertyChangedSignal("Value"):Connect(function()
        Car:PivotTo(Temp.Value)
    end)

    Tween:Play()
    Tween.Completed:Wait()
    Temp:Destroy()

    game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")

    task.wait(0.2)
    Root.Anchored = true
    task.wait(0.2)
    Root.Anchored = false
    task.wait(0.02)
end

-- Toggle autofarm dengan sedikit delay dan cek kondisi lebih aman
local Toggle = Tab:CreateToggle({
    Name = "Start Autofarm Fast [40-Second]",
    CurrentValue = false,
    Flag = "AutofarmToggle", -- Unique ID
    Callback = function(state)
        autofarmActive = state
        print("Status 'auto farm' diatur ke: " .. tostring(autofarmActive))

        if state then
            Rayfield:Notify({
                Title = "Autofarm Aktif",
                Content = "Proses autofarm telah dimulai.",
                Duration = 5,
                Image = "check",
            })
        else
            Rayfield:Notify({
                Title = "Autofarm Dimatikan",
                Content = "Proses autofarm dihentikan.",
                Duration = 5,
                Image = "cancel",
            })
        end

        if autofarmActive then
            task.spawn(function()
                print("Proses auto farm dimulai...")

                while autofarmActive do
                    TweenToJob()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    TakingJob()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    SpawningTruck()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    MovingCharacterToDestination(CFrame.new(-50937.152, 1012.215, -86353.031))
                    if not autofarmActive then break end
                    task.wait(0.5)

                    CountdownTeleport(40)
                    if not autofarmActive then break end
                    task.wait(0.5)

                    SitInVehicle()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    CarTween(CFrame.new(-50899.6015625, 1013.977783203125, -86534.9765625))
                    if not autofarmActive then break end
                    task.wait(3)
                end

                print("Proses auto farm telah dihentikan.")
            end)
        end
    end,
})

local Player = game.Players.LocalPlayer
local CarName = Player.Name .. "sCar"
local TweenService = game:GetService("TweenService")
local Vim = game:GetService("VirtualInputManager")

-- Fungsi helper Tween dengan wait sampai selesai
local function TweenCFrame(part, targetCFrame, duration, easingStyle, easingDirection)
    duration = duration or 1
    easingStyle = easingStyle or Enum.EasingStyle.Quad
    easingDirection = easingDirection or Enum.EasingDirection.Out

    local tweenInfo = TweenInfo.new(duration, easingStyle, easingDirection)
    local tween = TweenService:Create(part, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
    tween.Completed:Wait()
end

-- Fungsi tween teleport ke area kerja, diperbaiki menunggu tween selesai
function TweenToJob()
    game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")

    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end

    TweenCFrame(Root, Root.CFrame + Vector3.new(0, 100, 0), 0.5, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(-21799.8, 1142.65, -26797.7), 1, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(-21799.8, 1042.65, -26797.7), 1, Enum.EasingStyle.Exponential)

    Root.Anchored = true
    task.wait(0.3)
    Root.Anchored = false
end

-- Fungsi mengambil job "Truck" dengan sedikit perbaikan
function TakingJob()
    repeat
        local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
        local Waypoint = workspace.Etc.Waypoint:FindFirstChild("Waypoint")
        local Label = Waypoint and Waypoint:FindFirstChild("BillboardGui") and Waypoint.BillboardGui:FindFirstChild("TextLabel")

        if Root then Root.Anchored = true end

        if Label and Label.Text ~= "Rojod Semarang" then
            game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")
            local Prompt = workspace.Etc.Job.Truck.Starter:FindFirstChildWhichIsA("ProximityPrompt", true)
            if Prompt then
                Prompt.MaxActivationDistance = 100000
                fireproximityprompt(Prompt)
            end
        end

        if Root then Root.Anchored = false end
        task.wait(1) -- lebih panjang supaya tidak membebani
    until Label and Label.Text == "Rojod Semarang"

    Player.Character.HumanoidRootPart.Anchored = false
end

-- Fungsi spawn mobil + langsung duduk + destroy trailer (tidak saya ubah)
function SpawningTruck()
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end

    Root.CFrame = CFrame.new(-21782.941, 1042.03, -26786.959)

    task.wait(2)
    local Vim = game:GetService("VirtualInputManager")
    Vim:SendKeyEvent(true, "F", false, game)
    task.wait(0.3)
    Vim:SendKeyEvent(false, "F", false, game)
    task.wait(5)

    local Car = workspace.Vehicles:FindFirstChild(CarName)
    local Humanoid = Player.Character and Player.Character:FindFirstChild("Humanoid")
    local Seat = Car and Car:FindFirstChild("DriveSeat")

    if Humanoid and Seat then
        pcall(function() Seat:Sit(Humanoid) end)
        task.wait(0.5)
        Vim:SendKeyEvent(true, "Space", false, game)
        task.wait(0.1)
        Vim:SendKeyEvent(false, "Space", false, game)
    end

    local Trailer = Car and Car:FindFirstChild("Trailer1")
    if Trailer then
        Trailer:Destroy()
        print("Trailer destroyed to prevent interference.")
    end
end

-- Fungsi MovingCharacterToDestination sudah dioptimasi agar loop pivotTo lebih lambat dan terhenti tepat waktu
function MovingCharacterToDestination(Destination)
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    local Car = workspace.Vehicles:FindFirstChild(CarName)
    if not (Root and Car) then return end

    if not Car.PrimaryPart then
        for _, Part in ipairs(Car:GetDescendants()) do
            if Part:IsA("BasePart") then
                Car.PrimaryPart = Part
                break
            end
        end
    end

    local Follow = true
    local pivotThread = task.spawn(function()
        while Follow do
            if Car.PrimaryPart then
                Car:PivotTo(Root.CFrame + Vector3.new(5, 0, 0))
            end
            task.wait(0.3) -- lebih longgar supaya device gak berat
        end
    end)

    TweenCFrame(Root, Root.CFrame + Vector3.new(0, 100, 0), 0.4, Enum.EasingStyle.Quad)
    TweenCFrame(Root, CFrame.new(Destination.Position + Vector3.new(0, 100, 0)), 1.6, Enum.EasingStyle.Sine)
    TweenCFrame(Root, Destination, 1.8, Enum.EasingStyle.Exponential)

    Follow = false -- stop pivot thread

    Root.Anchored = true
    if Car.PrimaryPart then Car.PrimaryPart.Anchored = true end
    task.wait(0.8)
    if Car.PrimaryPart then Car.PrimaryPart.Anchored = false end
    Root.Anchored = false
end

function CountdownTeleport(seconds)
    for i = seconds, 1, -1 do
        print("Teleporting in " .. i .. " seconds...")
        task.wait(1)
    end
end

function SitInVehicle()
    local Car = workspace.Vehicles:FindFirstChild(CarName)
    local Hum = Player.Character and Player.Character:FindFirstChild("Humanoid")
    local Seat = Car and Car:FindFirstChild("DriveSeat")
    if Hum and Seat then pcall(function() Seat:Sit(Hum) end) end
end

-- CarTween sudah dioptimasi dengan wait tween selesai dan menghindari anchored toggle terlalu sering
function CarTween(TargetCFrame)
    local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Root then return end
    Root.Anchored = false

    task.wait(0.2)

    local Car = workspace.Vehicles:FindFirstChild(CarName)
    if not Car then warn("Vehicle not found.") return end
    if not Car.PrimaryPart then
        local Seat = Car:FindFirstChild("DriveSeat")
        if Seat then Car.PrimaryPart = Seat else return end
    end

    local Temp = Instance.new("CFrameValue", workspace)
    Temp.Value = Car:GetPivot()

    local Tween = TweenService:Create(Temp, TweenInfo.new(3, Enum.EasingStyle.Linear), {
        Value = TargetCFrame
    })

    Temp:GetPropertyChangedSignal("Value"):Connect(function()
        Car:PivotTo(Temp.Value)
    end)

    Tween:Play()
    Tween.Completed:Wait()
    Temp:Destroy()

    game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")

    task.wait(0.2)
    Root.Anchored = true
    task.wait(0.2)
    Root.Anchored = false
    task.wait(0.02)
end

-- Toggle autofarm dengan sedikit delay dan cek kondisi lebih aman
local Toggle = Tab:CreateToggle({
    Name = "Start Autofarm Slow [55-Second]",
    CurrentValue = false,
    Flag = "AutofarmToggle", -- Unique ID
    Callback = function(state)
        autofarmActive = state
        print("Status 'auto farm' diatur ke: " .. tostring(autofarmActive))

        if state then
            Rayfield:Notify({
                Title = "Autofarm Aktif",
                Content = "Proses autofarm telah dimulai.",
                Duration = 5,
                Image = "check",
            })
        else
            Rayfield:Notify({
                Title = "Autofarm Dimatikan",
                Content = "Proses autofarm dihentikan.",
                Duration = 5,
                Image = "cancel",
            })
        end

        if autofarmActive then
            task.spawn(function()
                print("Proses auto farm dimulai...")

                while autofarmActive do
                    TweenToJob()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    TakingJob()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    SpawningTruck()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    MovingCharacterToDestination(CFrame.new(-50937.152, 1012.215, -86353.031))
                    if not autofarmActive then break end
                    task.wait(0.5)

                    CountdownTeleport(55)
                    if not autofarmActive then break end
                    task.wait(0.5)

                    SitInVehicle()
                    if not autofarmActive then break end
                    task.wait(0.5)

                    CarTween(CFrame.new(-50899.6015625, 1013.977783203125, -86534.9765625))
                    if not autofarmActive then break end
                    task.wait(3)
                end

                print("Proses auto farm telah dihentikan.")
            end)
        end
    end,
})

local Paragraph = Tab:CreateParagraph({Title = "Infomation Autofarm", Content = "Autofarm sudah sepenuhnya diatur dan siap digunakan. Kamu tinggal tekan start untuk memulai prosesnya tanpa repot."})
