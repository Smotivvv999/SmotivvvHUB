-- Load Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "SkyCdidHub || cdid farm",
   Icon = 0,
   LoadingTitle = "loading...",
   LoadingSubtitle = "by Skyyy",
   ShowText = "Rayfield",
   Theme = "Default",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
})

local Tab = Window:CreateTab("Stats", "trending-up")
local Section = Tab:CreateSection("Farm Stats")

-- Simpan referensi ke paragraph untuk update realtime
local AutofarmStatsPara = Tab:CreateParagraph({Title = "Autofarm Stats", Content = "Idle"})
local WaitingTeleportPara = Tab:CreateParagraph({Title = "Waiting Teleport", Content = "Not waiting"})
local ElapsedTimePara = Tab:CreateParagraph({Title = "Elapsed Time", Content = "00:00:00"})

local Section = Tab:CreateSection("Earn Stats")  

-- Fungsi untuk format Rupiah
local function formatRupiah(amount)
    if not amount or amount == 0 then return "Rp 0" end
    local formatted = string.format("%.0f", amount)
    formatted = formatted:reverse():gsub("(%d%d%d)", "%1."):reverse()
    return "Rp " .. formatted:gsub("^,", "")
end

-- Variabel untuk tracking stats
local totalMoney = 0
local moneyReceived = 0
local moneyIncome = 0
local startTime = tick()
local lastMoney = 0

-- Paragraf untuk stats
local totalMoneyPara = Tab:CreateParagraph({Title="Total Money", Content="Rp 0"})
local moneyReceivedPara = Tab:CreateParagraph({Title="Total Earning", Content="Rp 0"})  -- Diubah dari "Money Received" ke "Total Earning"
local moneyIncomePara = Tab:CreateParagraph({Title="Money Received", Content="Rp 0 / Hour"})  -- Diubah dari "Money Income" ke "Money Received"

-- Fungsi update stats
local function updateStats()
    local currentMoneyText = game:GetService("Players").LocalPlayer.PlayerGui.Main.Container.Hub.CashFrame.Frame.TextLabel.Text
    
    -- Parsing lebih robust: hapus semua non-digit
    local cleanedText = currentMoneyText:gsub("[^%d]", "")  -- Hapus semua karakter non-digit
    local currentMoney = tonumber(cleanedText) or 0
    
    totalMoney = currentMoney
    totalMoneyPara:Set({Title="Total Money", Content=formatRupiah(totalMoney)})
    
    -- Hitung money received (selisih positif)
    if currentMoney > lastMoney then
        moneyReceived = moneyReceived + (currentMoney - lastMoney)
    end
    lastMoney = currentMoney
    moneyReceivedPara:Set({Title="Total Earning", Content=formatRupiah(moneyReceived)})  -- Diubah dari "Money Received" ke "Total Earning"
    
    -- Hitung money income (per hour)
    local elapsedTime = tick() - startTime
    if elapsedTime > 0 then
        moneyIncome = (moneyReceived / elapsedTime) * 3600  -- Konversi ke per jam
    end
    moneyIncomePara:Set({Title="Money Received", Content=formatRupiah(moneyIncome) .. " / Hour"})  -- Diubah dari "Money Income" ke "Money Received"
end

-- Update stats awal
updateStats()

-- Connect ke perubahan money
game:GetService("Players").LocalPlayer.PlayerGui.Main.Container.Hub.CashFrame.Frame.TextLabel.Changed:Connect(function()
    updateStats()
end)

-- Loop update stats setiap detik untuk income yang akurat
task.spawn(function()
    while true do
        task.wait(1)
        updateStats()
    end
end)

local Tab = Window:CreateTab("Configuration", "settings")
local Section = Tab:CreateSection("Set tele & recall job")

local Paragraph = Tab:CreateParagraph({
    Title = "Set Config Working",
    Content = [[
Teleport: 18 detik
Recall Job: 0.5
]]
})

-- Variabel untuk menyimpan nilai dari input
local recallJobTime = 0.5
local teleportTime = 18

local Input = Tab:CreateInput({
   Name = "Teleport",
   CurrentValue = "18",
   PlaceholderText = "Input teleport time in seconds",
   RemoveTextAfterFocusLost = false,
   Flag = "TeleportInput",
   Callback = function(Text)
       teleportTime = tonumber(Text) or 20
       print("Teleport time set to: " .. teleportTime)
   end,
})

local Input = Tab:CreateInput({
   Name = "Recall job",
   CurrentValue = "0.5",
   PlaceholderText = "Input recall job time in seconds",
   RemoveTextAfterFocusLost = false,
   Flag = "RecallJobInput",
   Callback = function(Text)
       recallJobTime = tonumber(Text) or 0.3
       print("Recall job time set to: " .. recallJobTime)
   end,
})

local Tab = Window:CreateTab("Autofarm", "plane-takeoff")
local Section = Tab:CreateSection("Executor Stats")

-- Fungsi untuk mendeteksi executor dengan lebih banyak checks
local function getExecutor()
    local executor = "Unknown"
    local version = ""
    
    -- Coba identifyexecutor() terlebih dahulu
    if identifyexecutor then
        pcall(function()
            executor = identifyexecutor()
        end)
    end
    
    -- Jika masih unknown, cek variabel global
    if executor == "Unknown" then
        if syn then
            executor = "Delta"
            if syn.version then version = " v" .. syn.version end
        elseif krnl then
            executor = "arceus X"
        elseif fluxus then
            executor = "Fluxus Z"
        elseif scriptware then
            executor = "codex"
        elseif xeno then
            executor = "Xeno"
            if xeno.version then version = " v" .. xeno.version end
        elseif getgenv then
            -- Jika getgenv ada tapi tidak spesifik, coba deteksi lain
            executor = "Unknown (getgenv detected)"
        elseif hookfunction then
            executor = "Unknown (hookfunction detected)"
        end
    end
    
    -- Gabungkan executor dan versi
    if version ~= "" then
        return executor .. version
    else
        return executor
    end
end

local Paragraph = Tab:CreateParagraph({Title = "Executor", Content = getExecutor()})

local Section = Tab:CreateSection("Autofarm [CAR DRIVING INDONESIA]")

-- Variabel untuk webhook URL
local webhookURL = ""

-- Fungsi untuk validasi URL webhook Discord
local function isValidDiscordWebhook(url)
    -- Cek apakah URL dimulai dengan https://discord.com/api/webhooks/ atau https://discordapp.com/api/webhooks/
    if string.match(url, "^https://discord%.com/api/webhooks/%d+/%w+$") or string.match(url, "^https://discordapp%.com/api/webhooks/%d+/%w+$") then
        return true
    end
    return false
end

local Input = Tab:CreateInput({
    Name = "Webhooks url",
    CurrentValue = "",
    PlaceholderText = "Paste Discord Webhook URL",
    RemoveTextAfterFocusLost = false,
    Flag = "WebhookInput",
    Callback = function(Text)
        local url = tostring(Text):gsub("%s+", "")

        -- VALIDASI PALING AMAN (executor proof)
        if url:find("discord") and url:find("/api/webhooks/") then
            webhookURL = url
            print("Webhook URL SET:", webhookURL)
        else
            webhookURL = ""
            warn("Invalid Discord Webhook URL")
        end
    end,
})


local Section = Tab:CreateSection("Autofarm [CAR DRIVING INDONESIA]")

local Player = game.Players.LocalPlayer
local CarName = Player.Name .. "sCar"
local TweenService = game:GetService("TweenService")
local Vim = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")

-- Variabel untuk autofarm
local autofarmActive = false
local autofarmStartTime = 0

-- Fungsi untuk format waktu elapsed (HH:MM:SS)
local function formatElapsedTime(seconds)
    local hours = math.floor(seconds / 3600)
    local minutes = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", hours, minutes, secs)
end

-- Fungsi update elapsed time
local function updateElapsedTime()
    if autofarmActive then
        local elapsed = tick() - autofarmStartTime
        ElapsedTimePara:Set({Title = "Elapsed Time", Content = formatElapsedTime(elapsed)})
    else
        ElapsedTimePara:Set({Title = "Elapsed Time", Content = "00:00:00"})
    end
end

local function sendWebhook(url, statusFarm, username, totalMoney, totalEarnings, elapsedTime)
    if not url or url == "" then return end

    local httpRequest =
        (syn and syn.request) or
        (http_request) or
        (request)

    if not httpRequest then
        warn("HTTP request function not supported by executor")
        return
    end

    -- Warna embed: hijau untuk sukses, merah untuk gagal
    local color = statusFarm == "Sukses" and 0x00FF00 or 0xFF0000

    local payload = {
        username = "BOT S3RA NEW ERA #1",
        avatar_url = "https://i.imgur.com/rdm3W9t.png", -- avatar bot
        embeds = {{
            title = "ðŸ‘‘ CAR DRIVING INDONESIA",
            description = "Autofarm job telah berhasil diselesaikan!",
            color = color,
            fields = {
                { name = "ðŸ“ Status Farm", value = tostring(statusFarm), inline = true },
                { name = "ðŸ‘¤ Username", value = tostring(username), inline = true },
                { name = "ðŸ’° Total Money", value = tostring(totalMoney), inline = true },
                { name = "ðŸ’µ Total Earnings", value = tostring(totalEarnings), inline = true },
                { name = "â±ï¸ Elapsed Time", value = tostring(elapsedTime), inline = true }
            },
            footer = {
                text = "Car Driving Indonesia | Autofarm",
                icon_url = "https://i.imgur.com/rdm3W9t.png"
            },
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }}
    }

    local success, err = pcall(function()
        httpRequest({
            Url = url,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode(payload)
        })
    end)

    if not success then
        warn("Webhook failed:", err)
    end
end

-- Fungsi tween teleport ke area kerja
function TweenToJob()
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Menuju lokasi job..."})
    pcall(function()
        game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")
        
        local Root = Player.Character:FindFirstChild("HumanoidRootPart")
        if not Root then return end

        TweenService:Create(Root, TweenInfo.new(1.0, Enum.EasingStyle.Quad), {
            CFrame = Root.CFrame + Vector3.new(0, 100, 0)
        }):Play()

        task.wait(1.0)
        TweenService:Create(Root, TweenInfo.new(2.0, Enum.EasingStyle.Quad), {
            CFrame = CFrame.new(-21797.01, 1042.02, -26796.73)
        }):Play()

        task.wait(2.0)
        TweenService:Create(Root, TweenInfo.new(2.0, Enum.EasingStyle.Exponential), {
            CFrame = CFrame.new(-21797.01, 1042.02, -26796.73)
        }):Play()

        task.wait(2.0)
        Root.Anchored = true
        task.wait(0.8)
        Root.Anchored = false
    end)
end

-- Fungsi mengambil job "Truck" dengan timeout anti-stuck
function TakingJob()
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Sedang eksekusi pekerjaan..."})
    local attempts = 0
    local maxAttempts = 50  -- Timeout after ~15 seconds (50 * 0.3)
    repeat
        if not autofarmActive then return end
        attempts = attempts + 1
        if attempts > maxAttempts then
            warn("TakingJob stuck, skipping...")
            return
        end
        pcall(function()
            local Root = Player.Character:FindFirstChild("HumanoidRootPart")
            local Waypoint = workspace.Etc.Waypoint:FindFirstChild("Waypoint")
            local Label = Waypoint and Waypoint:FindFirstChild("BillboardGui") and Waypoint.BillboardGui:FindFirstChild("TextLabel")

            if Root then Root.Anchored = true end

            if Label and Label.Text ~= "Rojod Semarang" then
                game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")
                local Prompt = workspace.Etc.Job.Truck.Starter:FindFirstChildWhichIsA("ProximityPrompt", true)
                if Prompt then
                    Prompt.MaxActivationDistance = 100000
                    fireproximityprompt(Prompt)
                end
            end

            if Root then Root.Anchored = false end
        end)
        task.wait(0.3)
    until (function()
        local Waypoint = workspace.Etc.Waypoint:FindFirstChild("Waypoint")
        local Label = Waypoint and Waypoint:FindFirstChild("BillboardGui") and Waypoint.BillboardGui:FindFirstChild("TextLabel")
        return Label and Label.Text == "Rojod Semarang"
    end)()

    pcall(function()
        Player.Character.HumanoidRootPart.Anchored = false
    end)
end

-- Fungsi spawn mobil + langsung duduk + destroy trailer dengan checks
function SpawningTruck()
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Menyiapkan truk..."})
    pcall(function()
        local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
        if not Root then return end

        Root.CFrame = CFrame.new(-21782.94, 1042.03, -26786.95)

        task.wait(3.0)
        Vim:SendKeyEvent(true, "F", false, game)
        task.wait(0.3)
        Vim:SendKeyEvent(false, "F", false, game)
        task.wait(3.0)

        local Car = workspace.Vehicles:FindFirstChild(CarName)
        local Humanoid = Player.Character and Player.Character:FindFirstChild("Humanoid")
        local Seat = Car and Car:FindFirstChild("DriveSeat")

        if Humanoid and Seat then
            pcall(function() Seat:Sit(Humanoid) end)
            task.wait(0.8)
            Vim:SendKeyEvent(true, "Space", false, game)
            task.wait(0.1)
            Vim:SendKeyEvent(false, "Space", false, game)
        end

        local Trailer = Car and Car:FindFirstChild("Trailer1")
        if Trailer then
            Trailer:Destroy()
            print("Trailer destroyed to prevent interference.")
        end
    end)
end

-- Fungsi bergerak ke destinasi dengan anti-stuck
function MovingCharacterToDestination(Destination)
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Menuju titik tujuan..."})
    pcall(function()
        local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
        local Car = workspace.Vehicles:FindFirstChild(CarName)

        if not (Root and Car) then return end

        if not Car.PrimaryPart then
            for _, Part in ipairs(Car:GetDescendants()) do
                if Part:IsA("BasePart") then
                    Car.PrimaryPart = Part
                    break
                end
            end
        end

        Root.Anchored = true
        if Car.PrimaryPart then Car.PrimaryPart.Anchored = true end

        local Follow = true
        local followThread = task.spawn(function()
            while Follow and autofarmActive do
                if Car.PrimaryPart and Root then
                    local offset = (Root.Position - Car.PrimaryPart.Position).Unit * 5
                    local newPos = Root.Position + offset
                    Car:PivotTo(CFrame.new(newPos))
                end
                task.wait(0.3)
            end
        end)

        local AboveStart = Root.CFrame + Vector3.new(0, 100, 0)
        local AboveDest = CFrame.new(Destination.Position + Vector3.new(0, 100, 0))

        local tween1 = TweenService:Create(Root, TweenInfo.new(5.0, Enum.EasingStyle.Quad), {CFrame = AboveStart})
        tween1:Play()
        tween1.Completed:Wait()

        local tween2 = TweenService:Create(Root, TweenInfo.new(8.0, Enum.EasingStyle.Sine), {CFrame = AboveDest})
        tween2:Play()
        tween2.Completed:Wait()

        local tween3 = TweenService:Create(Root, TweenInfo.new(6.0, Enum.EasingStyle.Exponential), {CFrame = Destination})
        tween3:Play()
        tween3.Completed:Wait()

        Follow = false
        task.wait()

        if Car.PrimaryPart then Car.PrimaryPart.Anchored = false end
        Root.Anchored = false
    end)
end

function CountdownTeleport(seconds)
    if not autofarmActive then return end
    WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Teleporting in " .. seconds .. " seconds..."})
    for i = seconds, 1, -1 do
        if not autofarmActive then return end
        WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Teleporting in " .. i .. " seconds..."})
        task.wait(1)
    end
    WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Not waiting"})
end

function SitInVehicle()
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Duduk di kendaraan..."})
    pcall(function()
        local Car = workspace.Vehicles:FindFirstChild(CarName)
        local Hum = Player.Character and Player.Character:FindFirstChild("Humanoid")
        local Seat = Car and Car:FindFirstChild("DriveSeat")
        if Hum and Seat then pcall(function() Seat:Sit(Hum) end) end
    end)
end

function CarTween(TargetCFrame)
    if not autofarmActive then return end
    AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Melaju ke tujuan..."})
    pcall(function()
        local Root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
        if not Root then return end
        Root.Anchored = false

        task.wait(0.5)

        local Car = workspace.Vehicles:FindFirstChild(CarName)
        if not Car then warn("Vehicle not found.") return end
        if not Car.PrimaryPart then
            local Seat = Car:FindFirstChild("DriveSeat")
            if Seat then Car.PrimaryPart = Seat else return end
        end

        local Temp = Instance.new("CFrameValue", workspace)
        Temp.Value = Car:GetPivot()

        local Tween = game:GetService("TweenService"):Create(Temp, TweenInfo.new(4, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Value = TargetCFrame
        })

        Temp:GetPropertyChangedSignal("Value"):Connect(function()
            Car:PivotTo(Temp.Value)
        end)

        Tween:Play()
        Tween.Completed:Wait()
        Temp:Destroy()

        game.ReplicatedStorage.NetworkContainer.RemoteEvents.Job:FireServer("Truck")

        task.wait(0.5)
        Root.Anchored = true
        task.wait(0.5)
        Root.Anchored = false
        task.wait(0.1)
    end)
end

-- Toggle Autofarm
local Toggle = Tab:CreateToggle({
   Name = "Start Autofarm",
   CurrentValue = false,
   Flag = "AutofarmToggle",
   Callback = function(Value)
       autofarmActive = Value
       print("Status 'auto farm' diatur ke: " .. tostring(autofarmActive))

       if autofarmActive then
           -- Reset stats saat mulai autofarm
           moneyReceived = 0
           startTime = tick()
           autofarmStartTime = tick()
           lastMoney = totalMoney
           updateStats()
           AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Starting Autofarm"})
           WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Not waiting"})
           
           -- Loop update elapsed time setiap detik
           task.spawn(function()
               while autofarmActive do
                   updateElapsedTime()
                   task.wait(1)
               end
           end)
           
           task.spawn(function()
               print("Proses auto farm dimulai... Target: 5B/Hour")
               
               while autofarmActive do
                   if not autofarmActive then break end
                   TweenToJob()
                   task.wait(recallJobTime)

                   if not autofarmActive then break end
                   TakingJob()
                   task.wait(recallJobTime)

                   if not autofarmActive then break end
                   SpawningTruck()
                   task.wait(recallJobTime)

                   if not autofarmActive then break end
                   MovingCharacterToDestination(CFrame.new(-50937.152, 1012.215, -86353.031))
                   task.wait(recallJobTime)

                   if not autofarmActive then break end
                   CountdownTeleport(teleportTime)
                   task.wait(recallJobTime)

                   if not autofarmActive then break end
                   SitInVehicle()
                   task.wait(recallJobTime)
                   
                   if not autofarmActive then break end
                   CarTween(CFrame.new(-50899.601, 1013.977, -86534.976)) 
                   task.wait(recallJobTime)

                   -- Kirim webhook setelah job berhasil
                   sendWebhook(webhookURL, "Active", Player.Name, formatRupiah(totalMoney), formatRupiah(moneyReceived), formatElapsedTime(tick() - autofarmStartTime), "Job completed successfully")
               end
               
               print("Proses auto farm telah dihentikan.")
               AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Idle"})
               WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Not waiting"})
           end)
       else
           AutofarmStatsPara:Set({Title = "Autofarm Stats", Content = "Idle"})
           WaitingTeleportPara:Set({Title = "Waiting Teleport", Content = "Not waiting"})
       end
   end,
})

-- BUTTON EXIT AUTOFARM (LEAVE GAME)
Tab:CreateButton({
   Name = "Exit Autofarm",
   Callback = function()
       print("Exit Autofarm ditekan")

       -- Matikan autofarm
       autofarmActive = false

       -- Lepaskan anchor
       pcall(function()
           local char = Player.Character
           if char and char:FindFirstChild("HumanoidRootPart") then
               char.HumanoidRootPart.Anchored = false
           end
       end)

       task.wait(0.5)

       -- Keluar dari game Roblox
       game:Shutdown()
   end,
})

local Tab = Window:CreateTab("Spin Box", "box")
local Section = Tab:CreateSection("open to spin box")

--// Variabel global untuk batas spin (dimulai dari 5)
local maxSpins = 5
local currentSpins = maxSpins

--// Variabel untuk cooldown 24 jam (dalam detik)
local cooldownDuration = 24 * 60 * 60 -- 24 jam
local cooldownEndTime = nil -- Waktu akhir cooldown

--// Label untuk menampilkan jumlah spin tersisa
local SpinLabel = Tab:CreateLabel("Spins Remaining: " .. currentSpins .. "/" .. maxSpins)

--// Label untuk menampilkan waktu cooldown jika aktif
local CooldownLabel = Tab:CreateLabel("Cooldown: Not active")

--// Fungsi untuk update label cooldown secara real-time
local function updateCooldownLabel()
    if cooldownEndTime then
        local remaining = cooldownEndTime - os.time()
        if remaining > 0 then
            local hours = math.floor(remaining / 3600)
            local minutes = math.floor((remaining % 3600) / 60)
            local seconds = remaining % 60
            CooldownLabel:Set(string.format("Cooldown: %02d:%02d:%02d", hours, minutes, seconds))
        else
            -- Reset spins setelah cooldown selesai
            currentSpins = maxSpins
            SpinLabel:Set("Spins Remaining: " .. currentSpins .. "/" .. maxSpins)
            CooldownLabel:Set("Cooldown: Not active")
            cooldownEndTime = nil
            Rayfield:Notify({
                Title = "Spins Reset!",
                Content = "Your spins have been reset. You can spin again!",
                Duration = 5,
                Image = "rotate-ccw"
            })
        end
    end
end

--// Loop untuk update cooldown setiap detik
task.spawn(function()
    while true do
        updateCooldownLabel()
        task.wait(1)
    end
end)

--// Tombol untuk Limited Box
local LimitedBoxButton = Tab:CreateButton({
    Name = "Spin Limited Box",
    Callback = function()
        updateCooldownLabel() -- Update cooldown sebelum cek
        if cooldownEndTime and os.time() < cooldownEndTime then
            local remaining = cooldownEndTime - os.time()
            local hours = math.floor(remaining / 3600)
            local minutes = math.floor((remaining % 3600) / 60)
            local seconds = remaining % 60
            Rayfield:Notify({
                Title = "Cooldown Active",
                Content = string.format("Please wait %02d:%02d:%02d before spinning again.", hours, minutes, seconds),
                Duration = 4,
                Image = "clock"
            })
            return
        end
        if currentSpins > 0 then
            startSpin("Limited Box")
        else
            Rayfield:Notify({
                Title = "No Spins Left",
                Content = "You have used all your spins. Cooldown started for 24 hours.",
                Duration = 4,
                Image = "x-octagon"
            })
            -- Mulai cooldown jika belum aktif
            if not cooldownEndTime then
                cooldownEndTime = os.time() + cooldownDuration
            end
        end
    end
})

--// Tombol untuk Gamepass Box
local GamepassBoxButton = Tab:CreateButton({
    Name = "Spin Gamepass Box",
    Callback = function()
        updateCooldownLabel() -- Update cooldown sebelum cek
        if cooldownEndTime and os.time() < cooldownEndTime then
            local remaining = cooldownEndTime - os.time()
            local hours = math.floor(remaining / 3600)
            local minutes = math.floor((remaining % 3600) / 60)
            local seconds = remaining % 60
            Rayfield:Notify({
                Title = "Cooldown Active",
                Content = string.format("Please wait %02d:%02d:%02d before spinning again.", hours, minutes, seconds),
                Duration = 4,
                Image = "clock"
            })
            return
        end
        if currentSpins > 0 then
            startSpin("Gamepass Box")
        else
            Rayfield:Notify({
                Title = "No Spins Left",
                Content = "You have used all your spins. Cooldown started for 24 hours.",
                Duration = 4,
                Image = "x-octagon"
            })
            -- Mulai cooldown jika belum aktif
            if not cooldownEndTime then
                cooldownEndTime = os.time() + cooldownDuration
            end
        end
    end
})

--// Fungsi universal untuk spin berdasarkan pilihan dropdown
function startSpin(spinType)
    local args
    local notifyTitle
    local notifyContent
    local notifyImage

    -- Atur parameter berdasarkan jenis spin (kondisi untuk Default/Claim dihapus)
    if spinType == "Limited Box" then
        args = { "Buy", "Limited Box" }
        notifyTitle = "Limited Box"
        notifyContent = "Spinning for limited rewards..."
        notifyImage = "package-open"
    elseif spinType == "Gamepass Box" then
        args = { "Buy", "Gamepass Box" }
        notifyTitle = "Gamepass Box"
        notifyContent = "Spinning with premium luck..."
        notifyImage = "zap"
    else
        Rayfield:Notify({
            Title = "Invalid Spin Type",
            Content = "Unknown option selected.",
            Duration = 4,
            Image = "x-octagon"
        })
        return
    end

    -- Tampilkan notifikasi awal
    Rayfield:Notify({
        Title = notifyTitle,
        Content = notifyContent,
        Duration = 3,
        Image = notifyImage
    })

    -- Simulasi animasi spin
    task.wait(3)

    -- Kirim RemoteEvent ke server
    local success, err = pcall(function()
        game:GetService("ReplicatedStorage")
            :WaitForChild("NetworkContainer")
            :WaitForChild("RemoteEvents")
            :WaitForChild("Box")
            :FireServer(unpack(args))
    end)

    -- Tampilkan notifikasi hasil dan kurangi spin jika berhasil
    if success then
        currentSpins = currentSpins - 1
        SpinLabel:Set("Spins Remaining: " .. currentSpins .. "/" .. maxSpins)  -- Update label
        Rayfield:Notify({
            Title = "Spin Successful!",
            Content = "You received a reward from: " .. spinType .. ". Spins left: " .. currentSpins,
            Duration = 5,
            Image = "gift"
        })
        -- Jika spins habis, mulai cooldown
        if currentSpins == 0 and not cooldownEndTime then
            cooldownEndTime = os.time() + cooldownDuration
        end
    else
        Rayfield:Notify({
            Title = "Spin Failed!",
            Content = "Error: " .. tostring(err),
            Duration = 5,
            Image = "alert-circle"
        })
    end
end
